# Handoff - Resonance
**Date:** 2024-12-17 10:30 | **Branch:** feat/backend-infrastructure-world-domain

## Summary
Enhanced the RAG experiment infrastructure with logging improvements and fixed two key issues: overly conservative LLM responses and duplicate entity expansion requests. Also added a missing character (Ashariel Cataliemne) to the test data.

## Completed
- File logger for LLM requests/responses (`packages/experiment/file-logger.ts`)
- Console logging showing capability arguments and entity names added to context
- Fixed path bug in file logger (was doubling the path)
- Temperature increased from 0.3 to 0.7 for better inference
- Rewrote system prompts to encourage reasonable inferences
- Added explicit "already expanded" list to capability descriptions
- Added duplicate EXPAND_ENTITY detection and warning
- Removed 500-char body truncation (now shows full content marked "complete")
- Created `test-data/world/characters/ashariel-cataliemne.md` from session notes research

## In Progress
- Testing RAG queries with tuned prompts (initial results look better)

## Key Decisions
- **Temperature 0.7**: 0.3 was too conservative, LLM wouldn't make reasonable inferences
- **Prompt rewrite**: Removed "rather than guessing" language that discouraged inference
- **Full content display**: Truncation with "..." made LLM think entities needed expansion

## Insights & Patterns
- LLMs take anti-hallucination instructions very literally - "rather than guessing" killed useful inference
- Context presentation matters: truncated content signals "incomplete" to the LLM
- Explicit capability constraints work better than implicit expectations

## Blocked
- None

## Next Steps
- Add progress spinner for LLM wait times (stored in memory)
- Add API cost tracking based on token usage (stored in memory)
- Continue testing queries and tuning prompts
- Test relationship-heavy queries

## Working Context
- Key files:
  - `packages/experiment/intelligence-orchestrator.ts` - Core RAG loop, prompts, capabilities
  - `packages/experiment/file-logger.ts` - Request/response logging
  - `packages/experiment/run-query.ts` - Entry point
  - `packages/experiment/logs/` - Log files (gitignored)
- Commands:
  - `bun run packages/experiment/run-query.ts "Your question"` - Run a query
  - `bun run scripts/test-mock-providers.ts` - Test mock providers

## Memory IDs
- 282a73fd-b7c7-4cad-b2b0-d768ca068e8d (implementation: logging improvements)
- 461caab9-1d3d-442d-8540-ff55e1b41067 (decision: temperature and prompt tuning)
- 311a3f9e-be45-49b4-9411-d5ecc63c5d31 (blocker: duplicate expansion fix)
- 1b38af07-0cca-4e41-aff5-683e2ac4ed0f (context: Ashariel character)
- 8668d38b-967a-4689-9a3a-28129a405e66 (context: project motivation)
- 9af92ba5-be40-4b33-af4b-16ea263d25ad (next-step: progress spinner)
- c1bfd1fe-40c5-46b1-b6bc-be455bb7d9c0 (next-step: cost tracking)
