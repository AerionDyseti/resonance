# Handoff - Resonance
**Date:** 2024-12-17 05:45 | **Branch:** feat/backend-infrastructure-world-domain

## Summary
Built a complete RAG experiment infrastructure for testing the Intelligence system. Converted Aerion's Notion worldbuilding export (Enym D&D world) into frontmatter markdown test data. Created mock providers and an LLM orchestrator using OpenRouter/DeepSeek v3.2. Ready to run queries and tune prompts.

## Completed
- Notion export converter: `scripts/convert-notion-export.ts`
- Test data: 348 entities (129 characters, 161 locations, 59 orgs), 243 relationships in `test-data/world/`
- Mock providers: `packages/experiment/mock-semantic-search.provider.ts`, `mock-relationship.provider.ts`
- Test data loader: `packages/experiment/test-data-loader.ts` (parses frontmatter markdown)
- OpenRouter client: `packages/experiment/openrouter-client.ts`
- Intelligence orchestrator: `packages/experiment/intelligence-orchestrator.ts` (RAG loop)
- Query runner: `packages/experiment/run-query.ts`
- Added `/test-data/` and `/notion-export/` to `.gitignore`

## In Progress
- Testing RAG queries with DeepSeek v3.2 model

## Key Decisions
- **Frontmatter markdown format** for test data: Human-readable, standard tooling, body stays as markdown for LLM consumption
- **Separate experiment package** (`packages/experiment/`): Keeps experimental code out of production `packages/backend/src/`
- **DeepSeek v3.2 via OpenRouter**: Much cheaper than Claude/GPT-4 for RAG prototyping
- **In-memory mock providers**: No database needed for experimentation, just loads from markdown files

## Insights & Patterns
- Notion export format: CSV files for structured data + markdown files in `DB/` subfolders for content
- Relationship links in Notion: `Name (https://www.notion.so/ID?pvs=21)` pattern
- Test data indexing: Build lookup maps by entity ID and name for fast relationship resolution

## Blocked
- None

## Next Steps
1. Run test queries: `bun run packages/experiment/run-query.ts "Tell me about Lady Jacqueline"`
2. Tune system prompts based on model responses
3. Adjust JSON response parsing if needed
4. Test relationship-heavy queries ("What locations are in Lux?", "Who are members of X?")

## Working Context
- Key files:
  - `packages/experiment/intelligence-orchestrator.ts` - Core RAG loop
  - `packages/experiment/run-query.ts` - Entry point for queries
  - `packages/experiment/.env` - OpenRouter API key (gitignored)
  - `test-data/world/{characters,locations,organizations}/` - Test entities
- Conventions: Entity IDs use prefixes `char-`, `loc-`, `org-`
- Commands:
  - `bun run packages/experiment/run-query.ts "Your question"` - Run a query
  - `bun run scripts/test-mock-providers.ts` - Test mock providers work
  - `bun run scripts/convert-notion-export.ts` - Regenerate test data from Notion export

## Memory IDs
- 1cbe41cc-39c1-4d37-9cda-d9f254b8ee75 (implementation: RAG infrastructure)
- e164675b-35d8-4005-ade2-72881d2290d1 (decision: frontmatter format)
- 41ba53a3-5b19-46ab-8057-21996d5fde24 (decision: DeepSeek model)
- 574a5226-9ca7-4e7f-8a90-995f43291075 (implementation: package structure)
- 9ed7b72e-2603-4a06-96f3-0efb9575d887 (implementation: Notion converter)
- 9bfae51c-7561-440b-a221-d0edef5a0633 (implementation: orchestrator loop)
- a06029b9-e578-4fa9-a262-acdcdb09446a (next-step: testing)
